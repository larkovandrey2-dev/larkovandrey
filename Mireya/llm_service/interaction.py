import re
import json
import requests
from statistics import mean

API_URL = "http://localhost:8081/generate"  # —ç–Ω–¥–ø–æ–∏–Ω—Ç —Ç–≤–æ–µ–≥–æ FastAPI
MODEL_RUNS = 3  # –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–≥–æ–Ω–æ–≤ –¥–ª—è —É—Å—Ä–µ–¥–Ω–µ–Ω–∏—è
MAX_REQUESTS = 10  # –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –º–æ–¥–µ–ª–∏

# –£—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã –ø–æ –∫–∞–∂–¥–æ–º—É –ø—É–Ω–∫—Ç—É
CLARIFY_QUESTIONS = {
    "1": "–ù–µ –º–æ–≥–ª–∏ –ª–∏ –≤—ã –∑–∞—Å–Ω—É—Ç—å –∏–ª–∏ —Å–ø–∞–ª–∏ –ø–ª–æ—Ö–æ?",
    "2": "–ë—ã–ª–æ –ª–∏ —Ç–∞–∫–æ–µ, —á—Ç–æ –≤—ã –Ω–µ —Ö–æ—Ç–µ–ª–∏ –µ—Å—Ç—å –∏–ª–∏ –µ–ª–∏ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ?",
    "3": "–ë—ã–ª–∏ –ª–∏ —Ä–µ–∑–∫–∏–µ –ø–µ—Ä–µ–ø–∞–¥—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è –±–µ–∑ –ø—Ä–∏—á–∏–Ω—ã?",
    "4": "–ù–µ –º–æ–≥–ª–∏ –ª–∏ –≤—ã —Å–¥–µ—Ä–∂–∞—Ç—å —Å–≤–æ—ë –≤–æ–ª–Ω–µ–Ω–∏–µ?",
    "5": "–ë—ã–ª–æ –ª–∏ —Ç—Ä—É–¥–Ω–æ —É—Å–∏–¥–µ—Ç—å –Ω–∞ –º–µ—Å—Ç–µ –∏–∑-–∑–∞ –Ω–µ—Ö–≤–∞—Ç–∫–∏ –≤—Ä–µ–º–µ–Ω–∏?",
    "6": "–ï—Å—Ç—å –ª–∏ —Å—Ä–µ–¥–∏ –≤–∞—à–∏—Ö –∑–∞–¥–∞–Ω–∏–π –æ—Å–æ–±–µ–Ω–Ω–æ —Å–ª–æ–∂–Ω—ã–µ –∏–ª–∏ –Ω–µ–ø–æ–Ω—è—Ç–Ω—ã–µ?",
    "7": "–ö–∞–∂–µ—Ç—Å—è –ª–∏ –≤–∞–º, —á—Ç–æ –≤–æ–∫—Ä—É–≥ –≤–∞—Å –æ–¥–Ω–∏ –≥–µ–Ω–∏–∏?",
    "8": "–ï—Å—Ç—å –ª–∏ —É –≤–∞—Å –¥—Ä—É–≥–∏–µ –ø—Ä–æ–±–ª–µ–º—ã, –æ –∫–æ—Ç–æ—Ä—ã—Ö —Ö–æ—Ç–∏—Ç–µ —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å?"
}

# –ë–∞–∑–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏
BASE_PROMPT = """–¢—ã ‚Äî –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∞—è —è–∑—ã–∫–æ–≤–∞—è –º–æ–¥–µ–ª—å. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî —Å—Ç—Ä–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –æ—Ü–µ–Ω–∏–≤–∞—Ç—å 8 –≤–æ–ø—Ä–æ—Å–æ–≤ –æ–ø—Ä–æ—Å–Ω–∏–∫–∞ –ø–æ —à–∫–∞–ª–µ 0‚Äì3.

–ü–†–ê–í–ò–õ–ê:

1. –†–∞–±–æ—Ç–∞–π —Ç–æ–ª—å–∫–æ —Å —Ç–µ–∫—Å—Ç–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
2. –ò—Å–ø–æ–ª—å–∑—É–π —à–∫–∞–ª—É:
   0 ‚Äî –Ω–µ—Ç, –Ω–∏–∫–æ–≥–¥–∞,
   1 ‚Äî —Å–∫–æ—Ä–µ–µ –Ω–µ—Ç,
   2 ‚Äî —Å–∫–æ—Ä–µ–µ –¥–∞,
   3 ‚Äî –¥–∞, –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞,
   -1 ‚Äî –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö.
3. –ï—Å–ª–∏ –µ—Å—Ç—å —è–≤–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –ø–æ –≤–æ–ø—Ä–æ—Å—É, –¥–∞–∂–µ –∫–æ—Ä–æ—Ç–∫–∏–µ —Ñ—Ä–∞–∑—ã, —Å—Ç–∞–≤—å –º–∏–Ω–∏–º—É–º 1. 
   –ù–∞–ø—Ä–∏–º–µ—Ä:
   - "–ø–ª–æ—Ö–æ —Å–ø–∞–ª", "–Ω–µ –º–æ–≥ —É—Å–Ω—É—Ç—å" ‚Üí Q1 ‚â• 1
   - "–Ω–µ —Ö–æ—Ç–µ–ª –µ—Å—Ç—å", "–µ–ª –≤—Å—ë –ø–æ–¥—Ä—è–¥" ‚Üí Q2 ‚â• 1
   - "—Ä–µ–∑–∫–∏–µ –ø–µ—Ä–µ–ø–∞–¥—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è" ‚Üí Q3 ‚â• 1
   - "–Ω–µ –º–æ–≥ —Å–¥–µ—Ä–∂–∞—Ç—å –≤–æ–ª–Ω–µ–Ω–∏–µ", "–±–µ—Å–ø–æ–∫–æ–∏–ª—Å—è" ‚Üí Q4 ‚â• 1
   - "–Ω–µ –º–æ–≥ —É—Å–∏–¥–µ—Ç—å", "–Ω–µ—Ä–≤–Ω–∏—á–∞–ª" ‚Üí Q5 ‚â• 1
   - "—Ç—Ä—É–¥–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è", "–Ω–µ–ø–æ–Ω—è—Ç–Ω—ã–µ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã–µ" ‚Üí Q6 ‚â• 1
   - "–∫–∞–∂–µ—Ç—Å—è, —á—Ç–æ –≤–æ–∫—Ä—É–≥ –≤—Å–µ –≥–µ–Ω–∏–∏" ‚Üí Q7 ‚â• 1
   - "–∏–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã", "—Ç—Ä—É–¥–Ω–æ—Å—Ç–∏", "—Å—Ç—Ä–µ—Å—Å" ‚Üí Q8 ‚â• 1
4. –ï—Å–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–µ—Ç –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ ‚Äî —Å—Ç–∞–≤—å -1.
5. –û—Ç–≤–µ—Ç —Å—Ç—Ä–æ–≥–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON, –±–µ–∑ –ª—é–±—ã—Ö —Å–ª–æ–≤, –ø—Ä–∏–º–µ—Ä–æ–≤, –ø–æ—è—Å–Ω–µ–Ω–∏–π, –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–π.

–§–û–†–ú–ê–¢ –í–´–í–û–î–ê:

{{
  "1": X,
  "2": X,
  "3": X,
  "4": X,
  "5": X,
  "6": X,
  "7": X,
  "8": X
}}

–ü—Ä–∏–º–µ—Ä—ã:

–¢–µ–∫—Å—Ç: "–°–µ–≥–æ–¥–Ω—è –ø–ª–æ—Ö–æ —Å–ø–∞–ª –∏ —Å–∏–ª—å–Ω–æ –Ω–µ—Ä–≤–Ω–∏—á–∞–ª"
–û—Ç–≤–µ—Ç:
{{
  "1": 2, "2": -1, "3": -1, "4": 1, "5": 1, "6": -1, "7": -1, "8": -1
}}

–¢–µ–∫—Å—Ç: "–ù–µ –º–æ–≥ —Å–ø—Ä–∞–≤–∏—Ç—å—Å—è —Å –¥–æ–º–∞—à–∫–æ–π, –≤—Å–µ –∫–∞–∑–∞–ª–æ—Å—å –Ω–µ–ø–æ–Ω—è—Ç–Ω—ã–º"
–û—Ç–≤–µ—Ç:
{{
  "1": -1, "2": -1, "3": -1, "4": -1, "5": -1, "6": 2, "7": -1, "8": -1
}}

–¢–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
{user_text}
–ï—Å–ª–∏ –µ—Å—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—É—Ç–æ—á–Ω–µ–Ω–∏—è), –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É—á–∏—Ç—ã–≤–∞–π –µ–≥–æ –ø—Ä–∏ –æ—Ü–µ–Ω–∫–µ –≤–æ–ø—Ä–æ—Å–æ–≤. 
–ï—Å–ª–∏ –≤ —É—Ç–æ—á–Ω–µ–Ω–∏—è—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —è–≤–Ω–æ –æ—Ç–≤–µ—á–∞–µ—Ç, –∑–∞–º–µ–Ω–∏ –∑–Ω–∞—á–µ–Ω–∏–µ -1 –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ —á–∏—Å–ª–æ 0‚Äì3. 
–ù–µ –æ—Å—Ç–∞–≤–ª—è–π -1, –µ—Å–ª–∏ –µ—Å—Ç—å —É—Ç–æ—á–Ω–µ–Ω–∏–µ.

–í—ã–≤–æ–¥–∏ —Ç–æ–ª—å–∫–æ JSON —Å—Ç—Ä–æ–≥–æ –ø–æ —Ñ–æ—Ä–º–∞—Ç—É –≤—ã—à–µ, –±–µ–∑ –ª—é–±—ã—Ö —Å–ª–æ–≤ –∏ –ø–æ—è—Å–Ω–µ–Ω–∏–π. –ï—Å–ª–∏ –µ—Å—Ç—å -1, —ç—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏ –Ω—É–∂–µ–Ω —É—Ç–æ—á–Ω—è—é—â–∏–π –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
"""
# -------------------------
# –ü—Ä–æ–º–ø—Ç –¥–ª—è —É—Ç–æ—á–Ω—è—é—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
# -------------------------
CLARIFY_PROMPT_TEMPLATE = """
–¢—ã ‚Äî –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∞—è —è–∑—ã–∫–æ–≤–∞—è –º–æ–¥–µ–ª—å. 
–¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –Ω–∞–π—Ç–∏ –æ—Ç–≤–µ—Ç—ã **—Ç–æ–ª—å–∫–æ** –Ω–∞ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã –∏–∑ —Å–ø–∏—Å–∫–∞.

–¢–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: 
{user_text}

–£–∂–µ –∏–∑–≤–µ—Å—Ç–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã (–Ω–µ —Ç—Ä–æ–≥–∞–π –∏—Ö):
{known_answers}

–í–æ–ø—Ä–æ—Å—ã, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –æ—Ç–≤–µ—Ç–∏—Ç—å:
{missing_questions}

–®–∫–∞–ª–∞:
0 ‚Äî –Ω–µ—Ç, –Ω–∏–∫–æ–≥–¥–∞
1 ‚Äî —Å–∫–æ—Ä–µ–µ –Ω–µ—Ç
2 ‚Äî —Å–∫–æ—Ä–µ–µ –¥–∞
3 ‚Äî –¥–∞, –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞
-1 ‚Äî –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö

–û—Ç–≤–µ—Ç —Å—Ç—Ä–æ–≥–æ –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ, –æ—Å—Ç–∞–≤—å –∏–∑–≤–µ—Å—Ç–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π.
"""

import re
import json
import requests
from statistics import mean

API_URL = "http://localhost:8081/generate"
MODEL_RUNS = 3
MAX_REQUESTS = 10

CLARIFY_QUESTIONS = {
    "1": "–ù–µ –º–æ–≥–ª–∏ –ª–∏ –≤—ã –∑–∞—Å–Ω—É—Ç—å –∏–ª–∏ —Å–ø–∞–ª–∏ –ø–ª–æ—Ö–æ?",
    "2": "–ë—ã–ª–æ –ª–∏ —Ç–∞–∫–æ–µ, —á—Ç–æ –≤—ã –Ω–µ —Ö–æ—Ç–µ–ª–∏ –µ—Å—Ç—å –∏–ª–∏ –µ–ª–∏ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ?",
    "3": "–ë—ã–ª–∏ –ª–∏ —Ä–µ–∑–∫–∏–µ –ø–µ—Ä–µ–ø–∞–¥—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è –±–µ–∑ –ø—Ä–∏—á–∏–Ω—ã?",
    "4": "–ù–µ –º–æ–≥–ª–∏ –ª–∏ –≤—ã —Å–¥–µ—Ä–∂–∞—Ç—å —Å–≤–æ—ë –≤–æ–ª–Ω–µ–Ω–∏–µ?",
    "5": "–ë—ã–ª–æ –ª–∏ —Ç—Ä—É–¥–Ω–æ —É—Å–∏–¥–µ—Ç—å –Ω–∞ –º–µ—Å—Ç–µ –∏–∑-–∑–∞ –Ω–µ—Ö–≤–∞—Ç–∫–∏ –≤—Ä–µ–º–µ–Ω–∏?",
    "6": "–ï—Å—Ç—å –ª–∏ —Å—Ä–µ–¥–∏ –≤–∞—à–∏—Ö –∑–∞–¥–∞–Ω–∏–π –æ—Å–æ–±–µ–Ω–Ω–æ —Å–ª–æ–∂–Ω—ã–µ –∏–ª–∏ –Ω–µ–ø–æ–Ω—è—Ç–Ω—ã–µ?",
    "7": "–ö–∞–∂–µ—Ç—Å—è –ª–∏ –≤–∞–º, —á—Ç–æ –≤–æ–∫—Ä—É–≥ –≤–∞—Å –æ–¥–Ω–∏ –≥–µ–Ω–∏–∏?",
    "8": "–ï—Å—Ç—å –ª–∏ —É –≤–∞—Å –¥—Ä—É–≥–∏–µ –ø—Ä–æ–±–ª–µ–º—ã, –æ –∫–æ—Ç–æ—Ä—ã—Ö —Ö–æ—Ç–∏—Ç–µ —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å?"
}

BASE_PROMPT = BASE_PROMPT = """–¢—ã ‚Äî –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∞—è —è–∑—ã–∫–æ–≤–∞—è –º–æ–¥–µ–ª—å. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –æ—Ü–µ–Ω–∏ 8 –≤–æ–ø—Ä–æ—Å–æ–≤ –æ–ø—Ä–æ—Å–Ω–∏–∫–∞ –ø–æ —à–∫–∞–ª–µ 0‚Äì3.
–ï—Å–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, —Å—Ç–∞–≤—å -1. –û—Ç–≤–µ—Ç —Å—Ç—Ä–æ–≥–æ –≤ JSON, —Ñ–æ—Ä–º–∞—Ç:

{{
  "1": X,
  "2": X,
  "3": X,
  "4": X,
  "5": X,
  "6": X,
  "7": X,
  "8": X
}}

–ü–û–î–°–ö–ê–ó–ö–ò:
- Q1 "–¢—ã –Ω–µ –º–æ–≥ –∑–∞—Å–Ω—É—Ç—å..." ‚Üí –∏—â–∏: "–ø–ª–æ—Ö–æ —Å–ø–∞–ª", "–Ω–µ –º–æ–≥ —É—Å–Ω—É—Ç—å", "–ø—Ä–æ—Å—ã–ø–∞–ª—Å—è –Ω–æ—á—å—é"
- Q2 "–ù–µ —Ö–æ—Ç–µ–ª–æ—Å—å –µ—Å—Ç—å –∏–ª–∏ –µ–ª –≤—Å—ë –ø–æ–¥—Ä—è–¥" ‚Üí –∏—â–∏: "–º–∞–ª–æ –µ–ª", "–Ω–µ —Ö–æ—Ç–µ–ª –µ—Å—Ç—å", "–µ–ª –≤—Å—ë –ø–æ–¥—Ä—è–¥"
- Q3 "–†–µ–∑–∫–∏–µ –ø–µ—Ä–µ–ø–∞–¥—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è" ‚Üí –∏—â–∏: "–Ω–µ—Ä–≤–Ω–∏—á–∞—é", "—Ä–µ–∑–∫–∏–µ –ø–µ—Ä–µ–ø–∞–¥—ã", "—ç–º–æ—Ü–∏–∏ —Å–∫–∞—á—É—Ç"
- Q4 "–ù–µ –º–æ–≥ —Å–¥–µ—Ä–∂–∞—Ç—å –≤–æ–ª–Ω–µ–Ω–∏–µ" ‚Üí –∏—â–∏: "–±–æ—é—Å—å", "—Ç—Ä–µ–≤–æ–≥–∞", "–≤–æ–ª–Ω—É—é—Å—å"
- Q5 "–¢—Ä—É–¥–Ω–æ —É—Å–∏–¥–µ—Ç—å –Ω–∞ –º–µ—Å—Ç–µ" ‚Üí –∏—â–∏: "–Ω–µ –º–æ–≥—É —É—Å–∏–¥–µ—Ç—å", "–Ω–µ—Ä–≤–Ω–∏—á–∞—é", "–Ω–µ —É—Å–ø–µ–≤–∞—é"
- Q6 "–°–ª–æ–∂–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è" ‚Üí –∏—â–∏: "–Ω–µ –ø–æ–Ω–∏–º–∞—é", "—Ç—Ä—É–¥–Ω—ã–µ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã–µ", "–¥–æ–º–∞—à–∫–∞ —Å–ª–æ–∂–Ω–∞—è"
- Q7 "–í–æ–∫—Ä—É–≥ –æ–¥–Ω–∏ –≥–µ–Ω–∏–∏" ‚Üí –∏—â–∏: "–≤–æ–∫—Ä—É–≥ –æ–¥–Ω–∏ –≥–µ–Ω–∏–∏", "–≤—Å–µ —É–º–Ω—ã–µ"
- Q8 "–ò–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã" ‚Üí –∏—â–∏: "–ø—Ä–æ–±–ª–µ–º—ã", "—Å—Ç—Ä–µ—Å—Å", "—Ç—Ä—É–¥–Ω–æ—Å—Ç–∏"

–ü—Ä–∏–º–µ—Ä—ã:

–¢–µ–∫—Å—Ç: "–°–µ–≥–æ–¥–Ω—è –ø–ª–æ—Ö–æ —Å–ø–∞–ª –∏ –Ω–µ—Ä–≤–Ω–∏—á–∞–ª"
–û—Ç–≤–µ—Ç:
{{
  "1": 2, "2": -1, "3": 1, "4": 2, "5": 1, "6": -1, "7": -1, "8": -1
}}

–¢–µ–∫—Å—Ç: "–ù–µ –º–æ–≥ —Å–ø—Ä–∞–≤–∏—Ç—å—Å—è —Å –¥–æ–º–∞—à–∫–æ–π, –≤—Å–µ –∫–∞–∑–∞–ª–æ—Å—å –Ω–µ–ø–æ–Ω—è—Ç–Ω—ã–º"
–û—Ç–≤–µ—Ç:
{{
  "1": -1, "2": -1, "3": -1, "4": -1, "5": -1, "6": 2, "7": -1, "8": -1
}}

–¢–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
{user_text}

–í—ã–≤–æ–¥–∏ —Ç–æ–ª—å–∫–æ JSON —Å—Ç—Ä–æ–≥–æ –ø–æ —Ñ–æ—Ä–º–∞—Ç—É –≤—ã—à–µ, –±–µ–∑ —Å–ª–æ–≤ –∏ –ø–æ—è—Å–Ω–µ–Ω–∏–π.
"""


CLARIFY_PROMPT_TEMPLATE = """–¢—ã ‚Äî –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∞—è —è–∑—ã–∫–æ–≤–∞—è –º–æ–¥–µ–ª—å. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –∑–∞–ø–æ–ª–Ω–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ–ø—Ä–æ—Å–Ω–∏–∫–∞.

–¢–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
{user_text}

–ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã:
{known_answers}

–ù—É–∂–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è:
{missing_questions}

–û—Ç–≤–µ—Ç–∏ —Ç–æ–ª—å–∫–æ –Ω–∞ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON, –Ω–µ –º–µ–Ω—è—è –∏–∑–≤–µ—Å—Ç–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã.
"""

def parse_json_from_text(text):
    """–ü–∞—Ä—Å–∏—Ç –ø–µ—Ä–≤—ã–π JSON –∏–∑ —Ç–µ–∫—Å—Ç–∞"""
    match = re.search(r"\{[^{}]+\}", text, re.DOTALL)
    if match:
        try:
            return {k: float(v) for k, v in re.findall(r'"?(\d)"?\s*:\s*(-?\d+\.?\d*)', match.group(0))}
        except:
            return {str(i): -1 for i in range(1, 9)}
    return {str(i): -1 for i in range(1, 9)}

def call_model(user_text):
    prompt = BASE_PROMPT.format(user_text=user_text)
    try:
        resp = requests.post(API_URL, json={"prompt": prompt})
        resp.raise_for_status()
        raw = resp.json().get("response", "")
    except:
        return {str(i): -1 for i in range(1, 9)}

    return parse_json_from_text(raw)

if __name__ == "__main__":
    user_input = input("–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:\n")
    result = call_model(user_input)
    print("\nüìå –ò—Ç–æ–≥–æ–≤—ã–π —Å–ª–æ–≤–∞—Ä—å:")
    print(result)

